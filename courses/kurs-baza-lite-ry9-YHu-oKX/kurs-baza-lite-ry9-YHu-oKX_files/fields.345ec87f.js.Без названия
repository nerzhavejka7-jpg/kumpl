var b=Object.defineProperty,v=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var u=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var c=(i,t,e)=>t in i?b(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,m=(i,t)=>{for(var e in t||(t={}))y.call(t,e)&&c(i,e,t[e]);if(u)for(var e of u(t))F.call(t,e)&&c(i,e,t[e]);return i},p=(i,t)=>v(i,w(t));var n=(i,t,e)=>new Promise((s,o)=>{var h=a=>{try{r(e.next(a))}catch(l){o(l)}},g=a=>{try{r(e.throw(a))}catch(l){o(l)}},r=a=>a.done?s(a.value):Promise.resolve(a.value).then(h,g);r((e=e.apply(i,t)).next())});import{V as f}from"./vendor.7502a816.js";import{o as M,c as P}from"./container.a98c7f55.js";import{d as x}from"./axios.98430d30.js";import{P as C,a as L,A as q,b as D}from"./PublicModalButtonPrev.f0f97be3.js";import{P as I,a as $}from"./public-modal-mixin.f4bb8596.js";import{P as B}from"./PublicModalDescription.ff17c798.js";import{P as E}from"./PublicModalButtonsContainer.2538eb2c.js";import{I as k}from"./InformFieldsFilled.9a3dbfc0.js";import{n as z}from"./lesson.da6d836a.js";import{P as A}from"./public-mixin.ebef26a5.js";import"./DefaultCountriesDropdown.c12c9430.js";import"./DefaultCountriesList.b3561a10.js";import"./DefaultDateDropdown.8cf82a83.js";import"./DefaultPhoneInput.b8ce65b6.js";import"./DefaultPasswordInput.d251d576.js";import"./CloseButtonLg.f7d7e9dd.js";import"./tiptap.716d285b.js";import"./index2.528d0f8a.js";const V="filling-fields";const d=x.create({baseURL:"/api/v1/",withCredentials:!0,headers:{Authorization:`Bearer ${window.token}`,"X-Language":window.app_current_locale}}),N={props:{required_fields:{type:Array,default:()=>[]},fields_url:{type:String,default:"/auth/user-fields"}},name:"FillingFieldsModal",mixins:[I],components:{PublicModalButtonPrev:C,InformFieldsFilled:k,PublicModalButtonNext:L,PublicModalButtonsContainer:E,AuthorizationDynamicFields:q,PublicModalDescription:B,PublicModalTitle:D,PublicModalView:$},data(){return{loading:!1,fields:this.required_fields,errors:{},message:"",success:!1,notifications:[],showExit:!1}},mounted(){this.openModal()},methods:{logout(){d.get("/auth/logout").then(()=>{window.location=window.app_url})},getLastField(){return this.fields[this.fields.length-1]},submit(){return n(this,null,function*(){this.loading=!0;try{if(yield d.post(this.fields_url,this.mapFieldsToPayload(),{headers:{"Content-Type":"multipart/form-data"}})){const t=yield d.get("/modal-notifications");this.notifications=t.data.data,this.success=!0}}catch(i){const{message:t,errors:e,failed_rules:s}=i.response.data;this.showExit=s&&s.includes("email.unique"),this.message=t,e?this.errors=e:this.errors={}}finally{this.loading=!1}})},mapFieldsToPayload(){const i=new FormData;return this.fields.forEach(t=>{t.type==="timezone"||t.type==="currency"||t.type==="dropdown"||t.type==="country"?t.value&&i.append(t.name,t.value.id):i.append(t.name,t.value)}),i},isRequiredFieldsFilled(i){return!i.filter(t=>t.is_required&&!t.value).length},displayMessage(){return this.message&&!Object.keys(this.errors).length},handleInform(i,t=!0){return n(this,null,function*(){this.hideModal()})}}};var R=function(){var t=this,e=t._self._c;return e("div",{staticClass:"fields-modal"},[e("public-modal-view",{directives:[{name:"show",rawName:"v-show",value:t.isModalVisible,expression:"isModalVisible"}],attrs:{"without-close":!!t.visible,loading:t.loading},on:{close:t.hideModal}},[t.success?e("InformFieldsFilled",{attrs:{notifications:t.notifications},on:{click:t.handleInform}}):e("form",{attrs:{id:"signup",autocomplete:"on"},on:{submit:function(s){s.preventDefault(),s.stopPropagation()}}},[t.isPassword()?[e("public-modal-title",[t._v(" "+t._s(t.$t("set_password"))+" ")]),e("public-modal-description",{staticClass:"mt-6",attrs:{large:""}},[t._v(" "+t._s(t.$t("set_password_description"))+" ")])]:[e("public-modal-title",[t._v(" "+t._s(t.$t("fill_title"))+" ")]),e("public-modal-description",{staticClass:"mt-6",attrs:{large:""}},[t._v(" "+t._s(t.$t("fill_descr"))+" ")])],t.getLastField().type==="email"?e("input",{staticClass:"hidden-field",attrs:{name:"email",autocomplete:"username email",type:"text"},domProps:{value:t.getLastField().value}}):t._e(),t.fields.length?e("AuthorizationDynamicFields",{staticClass:"mt-30",attrs:{errors:t.errors,fields:t.fields}}):t._e(),t.displayMessage()?e("div",{staticClass:"error"},[t._v(" "+t._s(t.message)+" ")]):t._e(),e("public-modal-buttons-container",{staticClass:"mt-30"},[t.showExit?e("PublicModalButtonPrev",{attrs:{text:t.$t("logout")},on:{click:t.logout}}):t._e(),e("PublicModalButtonNext",{attrs:{text:t.$t("next"),disabled:!t.isRequiredFieldsFilled(t.fields)},on:{click:t.submit}})],1)],2)],1)],1)},T=[],O=z(N,R,T,!1,null,"973b8359",null,null);const S=O.exports,{required_fields:_}=window;M(()=>{const i=P(V);if(!i||!_)return;const t=_;if(!t.length)return;f.mixin(A);const e=s=>s?s.map(o=>p(m({},o),{text:o.title,value:""})):[];new f({el:i,render:s=>s(S,{props:{visible:!0,required_fields:e(t)}})})});
//# sourceMappingURL=fields.345ec87f.js.map
